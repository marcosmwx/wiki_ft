"use strict";(self.webpackChunkwiki_42_mwx=self.webpackChunkwiki_42_mwx||[]).push([[1411],{8041:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>o});var s=i(4848),r=i(8453);const c={sidebar_position:3},d="Como funciona server.c",l={id:"rank 02/Minitalk/server",title:"Como funciona server.c",description:"Guia completo e explicadinho do server.c",source:"@site/docs/rank 02/Minitalk/server.mdx",sourceDirName:"rank 02/Minitalk",slug:"/rank 02/Minitalk/server",permalink:"/wiki_ft/docs/rank 02/Minitalk/server",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rank 02/Minitalk/server.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Makefile do Minitalk \ud83d\udee0\ufe0f",permalink:"/wiki_ft/docs/rank 02/Minitalk/makefile"},next:{title:"client",permalink:"/wiki_ft/docs/rank 02/Minitalk/client"}},a={},o=[{value:"Codigo \ud83e\uddfe",id:"codigo-",level:3},{value:"Panorama geral \ud83e\udde0",id:"panorama-geral-",level:2},{value:"PID \u2013 O que \xe9 e por que usar? \ud83d\udccc",id:"pid--o-que-\xe9-e-por-que-usar-",level:2},{value:"signal() e pause() \ud83d\udd01",id:"signal-e-pause-",level:2},{value:"handle_signal() \u2013 Como os bits viram letras? \ud83d\udcec",id:"handle_signal--como-os-bits-viram-letras-",level:2},{value:"Por que unsigned char? \ud83e\uddee",id:"por-que-unsigned-char-",level:3},{value:"Como o bit \xe9 montado? \ud83d\udd00",id:"como-o-bit-\xe9-montado-",level:3},{value:"Exemplo pr\xe1tico: caractere 42 (bin\xe1rio <code>00101010</code>)",id:"exemplo-pr\xe1tico-caractere-42-bin\xe1rio-00101010",level:3},{value:"O que acontece depois de 8 bits? \ud83c\udfaf",id:"o-que-acontece-depois-de-8-bits-",level:3},{value:"\ud83e\udde0 Conclus\xe3o",id:"-conclus\xe3o",level:3}];function t(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"como-funciona-serverc",children:"Como funciona server.c"})}),"\n",(0,s.jsx)(n.p,{children:"Guia completo e explicadinho do server.c"}),"\n",(0,s.jsx)(n.p,{children:"Primeiro da uma olhada rapida no codigo e tente entender minimamente.."}),"\n",(0,s.jsx)(n.h3,{id:"codigo-",children:"Codigo \ud83e\uddfe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:'#include "libft/libft.h"\n\nvoid    handle_signal(int sig)\n{\n        static unsigned char c;\n        static int                      bit = 0;\n\n        if (sig == SIGUSR2)\n                c |= (1 << (7 - bit));\n        bit++;\n        if (bit == 8)\n        {\n                if (c == \'\\0\')\n                        write(1, "\\n", 1);\n                else\n                        write(1, &c, 1);\n                c = 0;\n                bit = 0;\n        }\n}\n\nint     main(void)\n{\n        ft_printf("Server PID: %d\\n", getpid());\n        signal(SIGUSR1, handle_signal);\n        signal(SIGUSR2, handle_signal);\n\n        while (1)\n                ;\n        return (0);\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"panorama-geral-",children:"Panorama geral \ud83e\udde0"}),"\n",(0,s.jsxs)(n.p,{children:["O ",(0,s.jsx)(n.code,{children:"server.c"})," \xe9 a ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:'parte que "escuta"'})})," e recebe os sinais enviados pelo ",(0,s.jsx)(n.code,{children:"client.c"}),". Ele funciona assim:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"Exibe seu PID"})})," (identificador do processo no sistema)."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Isso \xe9 necess\xe1rio porque o cliente precisa saber para ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"qual processo enviar sinais"})}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["O PID \xe9 obtido com a fun\xe7\xe3o ",(0,s.jsx)(n.code,{children:"getpid()"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"Configura dois sinais personalizados"})}),", ",(0,s.jsx)(n.code,{children:"SIGUSR1"})," e ",(0,s.jsx)(n.code,{children:"SIGUSR2"}),", para representar bits bin\xe1rios:"]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SIGUSR1"})," representa o bit ",(0,s.jsx)(n.code,{children:"0"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SIGUSR2"})," representa o bit ",(0,s.jsx)(n.code,{children:"1"})]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["A cada sinal recebido, ele ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"vai montando um caractere bit a bit"})}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Quando 8 bits s\xe3o recebidos, ele monta um caractere da tabela ASCII."}),"\n",(0,s.jsxs)(n.li,{children:["Se for o caractere ",(0,s.jsx)(n.code,{children:"\\0"})," (null terminator), ele imprime uma nova linha."]}),"\n",(0,s.jsx)(n.li,{children:"Se for outro caractere, ele imprime na tela."}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["Tudo isso \xe9 feito com a fun\xe7\xe3o ",(0,s.jsx)(n.code,{children:"signal()"})," e um loop infinito SEM ",(0,s.jsx)(n.code,{children:"pause()"})," que mant\xe9m o servidor escutando."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"pid--o-que-\xe9-e-por-que-usar-",children:"PID \u2013 O que \xe9 e por que usar? \ud83d\udccc"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"PID (Process ID)"})})," \xe9 um n\xfamero \xfanico que identifica um processo rodando no sistema operacional."]}),"\n",(0,s.jsxs)(n.li,{children:["Com ",(0,s.jsx)(n.code,{children:"getpid()"}),", o servidor mostra esse n\xfamero para que o cliente possa enviar sinais especificamente para ele, com a fun\xe7\xe3o ",(0,s.jsx)(n.code,{children:"kill()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Exemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:'    ft_printf("Server PID: %d\\n", getpid());\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:(0,s.jsxs)(n.strong,{children:["Isso imprime algo como: ",(0,s.jsx)(n.code,{children:"Server PID: 12345"})]})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:(0,s.jsxs)(n.strong,{children:["O cliente usa esse ",(0,s.jsx)(n.code,{children:"12345"})," para saber para onde mandar os sinais."]})})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"signal-e-pause-",children:"signal() e pause() \ud83d\udd01"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"signal(SIGUSR1, handle_signal);\nsignal(SIGUSR2, handle_signal);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Aqui o servidor est\xe1 dizendo:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'"Quando eu receber SIGUSR1 ou SIGUSR2, execute a fun\xe7\xe3o handle_signal()."'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"while (1)\n    ;\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["nao usamos o",(0,s.jsx)(n.code,{children:"pause()"})," faz o programa esperar at\xe9 receber um sinal. pq ele faz confusao demora mais..","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Isso mant\xe9m o servidor parado, escutando."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"handle_signal--como-os-bits-viram-letras-",children:"handle_signal() \u2013 Como os bits viram letras? \ud83d\udcec"}),"\n",(0,s.jsx)(n.p,{children:"A m\xe1gica acontece aqui:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"void handle_signal(int sig)\n{\n    static unsigned char c;\n    static int bit = 0;\n\n    if (sig == SIGUSR2)\n        c |= (1 << (7 - bit));\n    bit++;\n    if (bit == 8)\n    {\n        if (c == '\\0')\n            write(1, \"\\n\", 1);\n        else\n            write(1, &c, 1);\n        c = 0;\n        bit = 0;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Vamos destrinchar:"}),"\n",(0,s.jsx)(n.h3,{id:"por-que-unsigned-char-",children:"Por que unsigned char? \ud83e\uddee"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"static unsigned char c;\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Um char comum armazena de -128 a 127"}),"\n",(0,s.jsx)(n.li,{children:"Um unsigned char armazena de 0 a 255"}),"\n",(0,s.jsx)(n.li,{children:"Como estamos construindo valores bin\xe1rios de 8 bits (1 byte), queremos usar todos os 256 valores poss\xedveis \u2014 por isso usamos unsigned."}),"\n",(0,s.jsx)(n.li,{children:"Tamb\xe9m evita problema com sinal negativo (bit mais \xe0 esquerda = sinal)."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"como-o-bit-\xe9-montado-",children:"Como o bit \xe9 montado? \ud83d\udd00"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"if (sig == SIGUSR2)\n    c |= (1 << (7 - bit));\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Aqui, se o sinal for SIGUSR2, ele representa o bit ",(0,s.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1 << (7 - bit)"})," move o bit ",(0,s.jsx)(n.code,{children:"1"})," para a posi\xe7\xe3o correta."]}),"\n",(0,s.jsxs)(n.li,{children:["O operador ",(0,s.jsx)(n.code,{children:"|="})," (bitwise OR) ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"ativa aquele bit"})})," em c."]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"exemplo-pr\xe1tico-caractere-42-bin\xe1rio-00101010",children:["Exemplo pr\xe1tico: caractere 42 (bin\xe1rio ",(0,s.jsx)(n.code,{children:"00101010"}),")"]}),"\n",(0,s.jsxs)(n.p,{children:["Entenda o que ta acontecendo na tabela e muito importante saber como ",(0,s.jsx)(n.code,{children:"MONTA"})," os bits na minitalk"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"bit atual"}),(0,s.jsx)(n.th,{children:"sinal recebido"}),(0,s.jsx)(n.th,{children:"opera\xe7\xe3o"}),(0,s.jsx)(n.th,{children:"resultado bin\xe1rio parcial"}),(0,s.jsx)(n.th,{children:"explica\xe7\xe3o"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"SIGUSR1"}),(0,s.jsx)(n.td,{children:"(nenhuma)"}),(0,s.jsx)(n.td,{children:"00000000"}),(0,s.jsx)(n.td,{children:"Bit 7 \xe9 0, ent\xe3o nada muda"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"SIGUSR1"}),(0,s.jsx)(n.td,{children:"(nenhuma)"}),(0,s.jsx)(n.td,{children:"00000000"}),(0,s.jsx)(n.td,{children:"Bit 6 \xe9 0, mant\xe9m"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"SIGUSR2"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1 << 5"})}),(0,s.jsx)(n.td,{children:"00100000"}),(0,s.jsx)(n.td,{children:"Ativa o bit 5"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"SIGUSR1"}),(0,s.jsx)(n.td,{children:"(nenhuma)"}),(0,s.jsx)(n.td,{children:"00100000"}),(0,s.jsx)(n.td,{children:"Bit 4 \xe9 0, mant\xe9m"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"SIGUSR2"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1 << 3"})}),(0,s.jsx)(n.td,{children:"00101000"}),(0,s.jsx)(n.td,{children:"Ativa o bit 3"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"SIGUSR1"}),(0,s.jsx)(n.td,{children:"(nenhuma)"}),(0,s.jsx)(n.td,{children:"00101000"}),(0,s.jsx)(n.td,{children:"Bit 2 \xe9 0, mant\xe9m"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"SIGUSR2"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1 << 1"})}),(0,s.jsx)(n.td,{children:"00101010"}),(0,s.jsx)(n.td,{children:"Ativa o bit 1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"SIGUSR1"}),(0,s.jsx)(n.td,{children:"(nenhuma)"}),(0,s.jsx)(n.td,{children:"00101010"}),(0,s.jsx)(n.td,{children:"Bit 0 \xe9 0, mant\xe9m"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["\ud83e\udde0 Resultado final: ",(0,s.jsx)(n.code,{children:"00101010"})," em bin\xe1rio = ",(0,s.jsx)(n.strong,{children:"42"})," em decimal = caractere ",(0,s.jsx)(n.code,{children:"*"})]}),"\n",(0,s.jsx)(n.h3,{id:"o-que-acontece-depois-de-8-bits-",children:"O que acontece depois de 8 bits? \ud83c\udfaf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"bit++;\nif (bit == 8)\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Quando 8 bits foram recebidos, significa que temos 1 caractere completo."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"if (c == '\\0')\n    write(1, \"\\n\", 1);\nelse\n    write(1, &c, 1);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Se for \\0, \xe9 o fim da string \u2192 quebra de linha."}),"\n",(0,s.jsx)(n.li,{children:"Se for outro caractere, escreve na tela."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Depois, zera tudo pra come\xe7ar a montar o pr\xf3ximo caractere:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C",children:"c = 0;\nbit = 0;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-conclus\xe3o",children:"\ud83e\udde0 Conclus\xe3o"}),"\n",(0,s.jsxs)(n.p,{children:["O ",(0,s.jsx)(n.code,{children:"server.c"})," funciona como um tradutor de sinais em texto:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ele recebe sinais ",(0,s.jsx)(n.code,{children:"SIGUSR1"})," e ",(0,s.jsx)(n.code,{children:"SIGUSR2"})," representando bits ",(0,s.jsx)(n.code,{children:"0"})," e ",(0,s.jsx)(n.code,{children:"1"})]}),"\n",(0,s.jsxs)(n.li,{children:["Monta um byte ",(0,s.jsx)(n.code,{children:"(unsigned char)"})," com 8 sinais"]}),"\n",(0,s.jsx)(n.li,{children:"Imprime o caractere correspondente na tela"}),"\n",(0,s.jsxs)(n.li,{children:["Repete isso at\xe9 que receba o caractere ",(0,s.jsx)(n.code,{children:"\\0"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var s=i(6540);const r={},c=s.createContext(r);function d(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);